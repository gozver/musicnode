<article>
  <section class="header">
    <div class=title>BAND PROFILE</div>
    <div class="subtitle">{{ profileBand?.name }}</div>
  </section>

  <section class="band-info">
    <!-- if the form is initialized, generate the template -->
    <form [formGroup]="bandForm" class="bandForm" *ngIf="bandForm">
      <div class="avatar">
        <input type="file" id="file" name="file" (change)="onFileSelected($event)" *ngIf="isMyBand" />

        <label for="file">
          <img [src]="imageData" [alt]="profileBand?.name" [ngClass]="isMyBand ? 'pointer' : 'normal'">
        </label>
      </div>

      <div class="band-data">
        <div class="text-bold">Contact Info:</div>
        <div class="text">{{ profileBand?.email }}</div>
        <div class="text">{{ profileBand?.users[0]?.email }}</div>
        <div class="text-bold">{{ profileBand?.phone }}</div>

        <!-- button type="button" to avoid form submission -->
        <button type="button" mat-flat-button color="warn" class="warn" *ngIf="!isMyBand" (click)="sendMessage(profileBand?.users[0]?.id)">
          Message
        </button>
      </div>
    </form>

    <div class="btn-ctnr">
      <button mat-flat-button color="warn" class="warn mb-20" (click)="updateImage()" *ngIf="isMyBand && this.avatarSelected">
        Update Avatar
      </button>
    </div>

    <div class="description">{{ profileBand?.desc }}</div>
  </section>

  <section class="band-images">
    <div class="band-images-ctnr">
      <owl-carousel-o class="owl-carousel-o" [options]="customOptions">
        <ng-template carouselSlide class="slide owl-carousel owl-theme owl-centered" *ngFor="let images of profileBand?.images">
          <img src="{{ images?.image }}" alt="{{ profileBand?.name }}" />
        </ng-template>  
      </owl-carousel-o>
    </div>
  </section>

  <section class="band-video">
    <h1>Promotional video:</h1>
    
    <div class="iframe-ctnr">
      <iframe width="560" height="315" [src]="profileBand?.video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen *ngIf="videoIsEmbeded"></iframe>
    </div>
  </section>

  <section class="band-musicians">
    <h1>{{ profileBand?.name }} musicians:</h1>
    
    <ul *ngFor="let musician of profileBand?.users">
      <li>- {{ musician?.name }} {{ musician?.surname }}</li>
    </ul>
  </section>

  <section class="band-reviews">
    <h1>Reviews:</h1>

    <div class="review" *ngFor="let review of reviewsList">
      <div class="user-ctnr">
        <div class="avatar">
          <img src="{{ review?.user?.avatar }}" alt="{{ review?.user?.name }}" />
        </div>
        
        <div class="user-info">
          <p class="full-name">{{ review?.user?.name }} {{ review?.user?.surname }}</p>

          <div class="rating" [ngSwitch]="review?.rating">
            <span *ngSwitchCase="'1'">
              <i class="material-icons">star</i>
            </span>

            <span *ngSwitchCase="'2'">
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
            </span>
            
            <span *ngSwitchCase="'3'">
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
            </span>

            <span *ngSwitchCase="'4'">
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
            </span>

            <span *ngSwitchCase="'5'">
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
              <i class="material-icons">star</i>
            </span>
          </div>

          <div class="date">{{ review.createdAt | date: 'short' }}</div>
        </div>
      </div>

      <div class="text">
        <p>{{ review?.body }}</p>
      </div>
    </div>
  </section>

  <section class="new-review">
    <h1>Write a Review:</h1>

    <div class="review-ctnr">
      <!-- <div class="avatar">
        <img src="{{ currentUser?.avatar }}" alt="{{ currentUser?.name }}" />
      </div> -->

      <!-- if the form is initialized, generate the template -->
      <form [formGroup]="reviewForm" *ngIf="reviewForm">
        <mat-form-field appearance="outline">
          <mat-label>Rating</mat-label>
          <mat-select formControlName="rating">
            <mat-option *ngFor="let item of ratingsList" value="{{ item.value }}">{{ item.value }}</mat-option>
          </mat-select>
          <button mat-icon-button matSuffix [attr.aria-label]="'Rating'" disabled>
            <mat-icon>category</mat-icon>
          </button>
        </mat-form-field>

        <mat-form-field appearance="outline" class="input-headline">
          <mat-label>Review</mat-label>
          <textarea matInput placeholder="Write a Review" formControlName="body" rows="3"></textarea>
          <button mat-icon-button matSuffix [attr.aria-label]="'Review'" disabled>
            <mat-icon matSuffix>text_snippet</mat-icon>
          </button>
        </mat-form-field>
      </form>

      <button mat-flat-button color="warn" class="warn" [disabled]="reviewForm.invalid" (click)="createReview()">
        Create Review
      </button>
    </div>
    
  </section>
</article>
